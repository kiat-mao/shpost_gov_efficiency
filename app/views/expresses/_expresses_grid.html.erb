<%- model_class = Express -%>
<%- model_class_b = Business -%>
<%- model_class_u = Unit -%>

<%= grid(@expresss_grid) do |g|
  g.column name: model_class.human_attribute_name(:express_no), attribute: 'express_no' do |express|
    [express.express_no,{style: 'font-size: 12px;'}]
  end

  g.column name: "二级行业", attribute: 'industry', assoc: :business do |express|
    [express.business.try(:industry),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class_b.human_attribute_name(:btype), attribute: 'btype', assoc: :business do |express|
    [express.business.try(:btype),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class_b.human_attribute_name(:code), attribute: 'code', assoc: :business do |express|
    [express.business.try(:code),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class_b.human_attribute_name(:name), attribute: 'name', assoc: :business do |express|
    [express.business.try(:name),{style: 'font-size: 12px;'}]
  end

  g.column name: '收寄单位代码', attribute: 'no', assoc: :post_unit do |express|
    [express.post_unit.try(:no),{style: 'font-size: 12px;'}]
  end

  g.column name: '收寄单位名称', attribute: 'name', assoc: :post_unit do |express|
    [express.post_unit.try(:name),{style: 'font-size: 12px;'}]
  end

  g.column name: '收寄区分公司', attribute: 'name', assoc: :post_unit do |express|
    [express.post_unit.try(:parent_unit).try(:name),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:posting_date), attribute: 'posting_date' do |express|
    [(l express.posting_date),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:receiver_district), attribute: 'receiver_district' do |express|
    [express.try(:receiver_district),{style: 'font-size: 12px;'}]
  end

  g.column name: '最后投递区分公司', attribute: 'name', assoc: :last_unit do |express|
    [express.last_unit.try(:parent_unit).try(:name),{style: 'font-size: 12px;'}]
  end

  g.column name: '最后投递单位', attribute: 'no', assoc: :last_unit do |express|
    [express.last_unit.try(:no)||express.last_unit_no,{style: 'font-size: 12px;'}]
  end

  g.column name: '最后投递单位名称', attribute: 'name', assoc: :last_unit do |express|
    [express.last_unit.try(:name)||express.last_unit_name,{style: 'font-size: 12px;'}]
  end

  # g.column name: model_class.human_attribute_name(:status), attribute: 'status' do |express|
  #   express.status_name
  # end
  g.column name: model_class.human_attribute_name(:status), attribute: 'status', custom_filter: Express::STATUS_NAME.invert do |express| 
    if express.status.eql?"waiting"
      [express.status_name, {style: 'font-size: 12px;color: red;'}]
    else
      [express.status_name,{style: 'font-size: 12px;'}]
    end
  end

  g.column name: '轨迹位置', attribute: 'whereis', custom_filter: Express::WHEREIS_NAME.invert do |express| 
    [express.whereis_name, {style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:last_op_desc), attribute: 'last_op_desc' do |express|    [express.try(:last_op_desc),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:last_op_at), attribute: 'last_op_at' do |express|
    [(express.last_op_at.blank? ? "" : (l express.last_op_at)),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:receipt_flag), attribute: 'receipt_flag' do |express|
    [(express.receipt_flag_name),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:receipt_status), attribute: 'receipt_status' do |express|
    [(express.receipt_status_name),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:pre_waybill_no), attribute: 'pre_waybill_no' do |express|
    [(express.pre_waybill_no),{style: 'font-size: 12px;'}]
  end

  g.column name: model_class.human_attribute_name(:receipt_waybill_no), attribute: 'receipt_waybill_no' do |express|
    [(express.receipt_waybill_no),{style: 'font-size: 12px;'}]
  end

  g.column in_csv: false do |express|
    ActiveSupport::SafeBuffer.new << 
      (link_to '邮件全过程信息', get_mail_trace_express_path(express), :class => 'btn btn-xs btn-primary', target: '_blank' if can? :read, express) 
  end

end
%>