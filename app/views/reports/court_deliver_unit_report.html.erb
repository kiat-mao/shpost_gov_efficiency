
<br>
<font face="微软雅黑" color='#006030' size=6>法院异地投递情况监控报表-投递维度</font>   



<%= form_tag(court_deliver_unit_report_reports_path, name: 'form', method: 'post') do %>
  <table>
    <tr style="line-height: 40px;height: 40px;">
      <td><%= label_tag(:btype, "客户类别:") %></td>
      <td><%= select_tag(:btype, options_for_select(Business.where(industry: "法院").select(:btype).distinct.map{|i| [i.btype,i.btype]}.insert(0,""), :selected=> params[:btype]), id: "btype") %></td>
      <td><%= label_tag(:business, "客户:") %></td>
      <td><%= text_field_tag(:business, params[:business]) %></td>  
    </tr>
    <tr style="line-height: 40px;height: 40px;">
      <td><%= label_tag(:posting_date_start, "收寄范围:") %></td>
      <td><%= text_field_tag(:posting_date_start, params[
        :posting_date_start], class: 'datepicker', 'data-date-format' => 'yyyy-mm-dd', value: params[:posting_date_start].blank? ? Date.today-7.day : params[:posting_date_start]) %></td>
        <td><%= label_tag(:posting_date_end, "-") %></td>
        <td><%= text_field_tag(:posting_date_end, params[:posting_date_end], class: 'datepicker', 'data-date-format' => 'yyyy-mm-dd', value: params[:posting_date_end].blank? ? Date.today-2.day : params[:posting_date_end]) %></td>

    </tr>
  </table>
  <table>
    <tr>
      <td>
        <div id="unit_report_search">
          <%= submit_tag "查询", :class => 'btn btn-primary', method: :post %>
        </div>
      <td>
        <div id="export">
          <%= link_to "报表导出", deliver_unit_report_export_reports_path(industry: params[:industry], btype: params[:btype], business: params[:business], posting_date_start: params[:posting_date_start], posting_date_end: params[:posting_date_end]), :class => 'btn btn-primary', method: :post%>
        </div>
      </td>
    </tr>
  </table>
  <%= hidden_field_tag('is_search', @is_search) %>
  <%= hidden_field_tag('industry', '法院') %>
<% end -%>      
  <br>
  <% if !@results.blank? %>
    <table data-toggle="table" 
    data-height="400">
      <thead>
        <tr class= 'nowrap'>
          <th><b>单位</b></th>
          <th><b>网点</b></th>
          <th><b>总邮件数</b></th>
          <th><b>总妥投数</b></th>
          <th><b>妥投率</b></th>
          <th><b>三日妥投率</b></th>
          <th><b>次日妥投率</b></th>
          <th><b>未妥投总数</b></th>
          <th><b>未妥投率</b></th>
          <th><b>退回数</b></th>
          <th><b>退回率</b></th>
        </tr>
      </thead>
      <tbody>
      <% last_pid = nil %>
      <% @results.each do |k, v| %>
         <tr class= 'nowrap'>
          <td><%= (k.blank? || (k.eql?"合计")) ? "" : ((v[0] == last_pid) ? "" : (k.parent_id.blank? ? "" : k.parent_unit.name)) %></td>
          <td><%= k.blank? ? "其他" : ((k.eql?"合计") ? k : k.name) %></td>
          <td><u><%= link_to v[1], get_expresses_path(nil, nil, (k.blank? ? "其他" : k)), target: '_blank' %></u></td>
          <td><u><%= link_to v[2], get_expresses_path(nil, "delivered", (k.blank? ? "其他" : k)), target: '_blank' %></u></td>
          <td><%= v[3].to_s(:rounded, precision: 2)+"%" %></td>
          <td><%= v[4].to_s(:rounded, precision: 2)+"%" %></td>
          <td><%= v[5].to_s(:rounded, precision: 2)+"%" %></td>
          <td id='waiting'><%= link_to v[6], get_expresses_path(nil, "waiting", (k.blank? ? "其他" : k)), target: '_blank' %></td>
          <td><font color="red"><%= v[7].to_s(:rounded, precision: 2)+"%" %></font></td>
          <td><u><%= link_to v[8], get_expresses_path(nil, "returns", (k.blank? ? "其他" : k)), target: '_blank' %></u></td>
          <td><%= v[9].to_s(:rounded, precision: 2)+"%" %></td>
          <% last_pid = v[0] %>
        </tr>
      <% end %>
      </tbody>
    </table>
  <% end %>

<script language="javascript" type="text/javascript"> 

$(document).ready(function(){
  if($("#is_search").val()!="yes"){
      $("#export").hide();
  }
})

</script> 